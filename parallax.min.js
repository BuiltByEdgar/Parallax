/**********************************************************************************
 *
 * Parallax.js: Mouse parallax effect
 *
 * Parallax.js is a lightweight and simple mouse parallax effect. Simple to use 
 * and works with the mouse and reacts to the orientation of your smart device.
 * 
 *
 * @author:  Edgar Bermejo - @BuiltByEdgar - http://builtbyedgar.com/
 * @version: 0.1.2 - Beta (29/08/2015)
 * @repository: https://github.com/BuiltByEdgar/Parallax
 * @license: MIT License
 *
 *
 * @container { DOM Object }
 * @options { Object }:
 * @power: Float (default = 5). How much 3D effect to use (from -10 to 10).
 * @axis: "x", "y" or "both". In which axis to apply the "3D" effect.
 * @controls: "mouse" or "orientation". Determine which is the event to controll it.
 * @scope: "global" or "local". From which base coordinate system to calculate 
 * the mouse position and parallax effect.
 *
 *
 **********************************************************************************/


 "use strict";function Parallax(a,b){var c={className:"parallax",power:.5,axis:"x",controls:"mouse",scope:"global"};this._extend(c,b),this.o=c,this.container=a,this.capture=null,this.el=[],this.transformPrefix=this._getPrefix(["transform","-ms-transform","-moz-transform","-webkit-transform","-o-transform"]),window.addEventListener("DOMContentLoaded",this._load.bind(this),!1)}Parallax.prototype._load=function(){"global"===this.o.scope?this.capture=window:this.capture=this.container,"orientation"===this.o.controls||this._isMobile()?(this.orientation={x:0,y:0,cx:.5*this.capture.innerWidth,cy:this.capture.innerHeight},window.addEventListener("deviceorientation",this._deviceOrientationHandler.bind(this),!1)):(this.pointer={x:0,y:0,cx:0,cy:0},this.capture.addEventListener("mousemove",this._mouseMoveHandler.bind(this),!1)),this.el=document.getElementsByClassName(this.o.className),this.windowWidth=this.capture.innerWidth,this.windowHeight=this.capture.innerHeight,window.addEventListener("resize",this._resize.bind(this),!1),window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||null}(),this._run()},Parallax.prototype._deviceOrientationHandler=function(a){this.orientation.x=a.gamma>2||a.gamma<-2?a.gamma:0,this.orientation.y=a.beta>2||a.beta<-2?a.beta:0},Parallax.prototype._mouseMoveHandler=function(a){this.pointer.x=a.pageX,this.pointer.y=a.pageY},Parallax.prototype._run=function(){"orientation"===this.o.controls||this._isMobile()?(this.orientation.cx+=(this.orientation.x-this.orientation.cx)/10,this.orientation.cy+=(this.orientation.y-this.orientation.cy)/10):(this.pointer.cx+=(this.pointer.x-this.pointer.cx)/10,this.pointer.cy+=(this.pointer.y-this.pointer.cy)/10);for(var a=0,b=this.el.length;b>a;a++){var c=0,d=0,e=this.el[a],f=(e.dataset.power||this.o.power)/10;"orientation"===this.o.controls||this._isMobile()?(("x"===this.o.axis||"both"===this.o.axis)&&(c=10*this.orientation.cx*-f),("y"===this.o.axis||"both"===this.o.axis)&&(d=10*this.orientation.cy*-f)):(("x"===this.o.axis||"both"===this.o.axis)&&(c=(this.pointer.cx-.5*this.windowWidth)*-f),("y"===this.o.axis||"both"===this.o.axis)&&(d=(this.pointer.cy-.5*this.windowHeight)*-f)),e.style[this.transformPrefix]=e.style.webkitTransform="matrix3d( 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, "+c+", "+d+", 0, 1)"}requestAnimFrame(this._run.bind(this))},Parallax.prototype._getPrefix=function(a){for(var c=(document.createElement("div"),""),d=0;d<a.length;d++){c=a[d];break}return c},Parallax.prototype._resize=function(a){this.windowWidth=this.capture.innerWidth,this.windowHeight=this.capture.innerHeight},Parallax.prototype._isMobile=function(a){return navigator.userAgent.match(/Android|BlackBerry|iPhone|iPad|iPod|Opera Mini|IEMobile/i)?!0:!1},Parallax.prototype._extend=function(a,b){for(var c in b)b[c]&&b[c].constructor&&b[c].constructor===Object?(a[c]=a[c]||{},arguments.callee(a[c],b[c])):a[c]=b[c];return a};